<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PIN認証システム技術仕様書</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            font-size: 18px; /* 文字サイズを大きくする */
            padding: 20px;
        }
        h1, h2, h3 {
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap; /* 自動で折り返す */
            word-wrap: break-word; /* 自動で折り返す */
            font-size: 16px;
        }
    </style>
</head>
<body>
<pre>
# PIN認証システム技術仕様書

## 概要
脳トレゲームシステムに導入されたPIN認証システムの技術仕様書

作成日：2025年6月21日
作成者：小川 清志　医療AIソリューションアーキテクト（リハビリ用AIゲーム開発・運用担当）
バージョン：2.0

## 目次
1. システム概要
2. 技術仕様
3. セキュリティ仕様
4. 運用仕様
5. トラブルシューティング
6. 更新履歴

## 1. システム概要

### 1.1 目的
- 顔認証からPIN認証方式への移行
- セキュリティの強化
- 利用者本人確認の確実性向上
- 利用状況の自動記録と監視

### 1.2 システム構成
- フロントエンド：HTML5 + JavaScript
- 認証方式：PIN認証（6桁以上の英数字混合）
- データ保存：localStorage
- セッション管理：JavaScript

### 1.3 対応環境
- ブラウザ：Chrome 80以上、Firefox 75以上、Safari 13以上、Edge 80以上
- 入力デバイス：キーボード対応
- ネットワーク：院内Wi-Fi環境

## 2. 技術仕様

### 2.1 PIN認証フロー
```
1. システムアクセス
   ↓
2. PIN認証チェック
   ↓
3. 未認証の場合 → PIN認証登録ページへリダイレクト
   ↓
4. 個人情報入力
   ↓
5. PIN設定（6桁以上の英数字混合）
   ↓
6. 登録完了
   ↓
7. メインシステムアクセス
```

### 2.2 PIN認証登録仕様
- **PIN強度チェック**: 6桁以上、英数字混合、連続数字禁止
- **データ保存**: localStorageにユーザー情報とPINを保存
- **データ構造**: 
  ```json
  {
    "lastName": "姓",
    "firstName": "名",
    "birthDate": "生年月日",
    "gender": "性別",
    "email": "メールアドレス",
    "phone": "電話番号",
    "emergencyContact": "緊急連絡先",
    "jobTitle": "職種",
    "medicalInfo": "医療情報",
    "pin": "暗号化されたPIN",
    "registrationDate": "登録日時",
    "permissions": ["権限配列"]
  }
  ```

### 2.3 セッション管理仕様
- **有効期限**: 30分
- **チェック方法**: 認証時刻から30分経過を判定
- **自動再認証**: 有効期限切れ時に自動的にPIN認証ページへリダイレクト
- **手動ログアウト**: ログアウトボタンで即座にセッション無効化

### 2.4 利用履歴記録仕様
- **記録項目**: 
  - ユーザー名
  - ゲーム名
  - 開始時刻
  - 終了時刻
  - スコア
  - 利用時間
  - セッションID
- **保存場所**: localStorage
- **データ形式**: JSON配列

## 3. セキュリティ仕様

### 3.1 認証セキュリティ
- **PIN認証必須化**: システムアクセス前に必ずPIN認証を実行
- **セッション管理**: 30分の有効期限設定
- **自動ログアウト**: 有効期限切れ時の自動ログアウト
- **アクセス制御**: 未認証ユーザーのシステムアクセス完全ブロック
- **アカウントロック**: 5回失敗で30分間ロック

### 3.2 データセキュリティ
- **ローカル保存**: PIN認証データは端末のlocalStorageに保存
- **暗号化**: 機密データの安全な保存
- **アクセス制限**: 管理者のみが利用履歴を閲覧可能
- **データ保護**: ブラウザのプライベートモードでの利用制限

### 3.3 プライバシー保護
- **個人情報**: 必要最小限の個人情報のみ収集
- **利用目的**: 本人確認のみに使用
- **データ削除**: ログアウト時にセッションデータをクリア
- **PIN強度**: 6桁以上の英数字混合を強制

## 4. 運用仕様

### 4.1 管理者機能
- **利用履歴確認**: 全利用者の利用状況を確認可能
- **フィルタリング**: 日付、ユーザー、ゲーム別での絞り込み
- **統計表示**: 利用回数、平均利用時間等の統計情報
- **エクスポート**: 利用履歴データのCSV出力

### 4.2 一般利用者機能
- **PIN認証登録**: 初回利用時のPIN認証登録
- **ゲーム利用**: 認証完了後の脳トレゲーム利用
- **ログアウト**: 手動ログアウト機能

### 4.3 システム監視
- **利用状況監視**: リアルタイムでの利用状況確認
- **異常検知**: 不審な利用パターンの検知
- **ログ記録**: システムアクセスログの記録
- **アラート機能**: 異常時の管理者への通知

## 5. トラブルシューティング

### 5.1 よくある問題と対処法

#### 5.1.1 PINが入力できない
**症状**: PIN入力フィールドに文字が入力されない
**原因**: 
- ブラウザの設定でJavaScriptが無効
- 入力フィールドが無効化されている
- アカウントがロックされている

**対処法**:
1. ブラウザの設定でJavaScriptを有効化
2. ページの再読み込み
3. ロック解除まで待機（30分）

#### 5.1.2 PIN認証が失敗する
**症状**: PINが正しくない、認証エラーが発生する
**原因**:
- PINの入力ミス
- アカウントがロックされている
- セッション期限切れ

**対処法**:
1. PINの正確な入力
2. ロック解除まで待機
3. 再ログイン

#### 5.1.3 セッションが切れる
**症状**: 30分経過後に自動的にログアウトされる
**原因**: セッション有効期限（30分）の経過
**対処法**: 再びPIN認証を実行

#### 5.1.4 利用履歴が表示されない
**症状**: 管理者ページで利用履歴が表示されない
**原因**:
- 管理者権限がない
- データが保存されていない
- ブラウザのlocalStorageが無効

**対処法**:
1. 管理者権限の確認
2. ブラウザのlocalStorage設定確認
3. データの再保存

## 6. 更新履歴

### v2.0 (2025年6月21日)
- 顔認証システムからPIN認証システムへの移行
- セキュリティ機能の強化
- アカウントロック機能の追加
- セッション管理の改善

### v1.0 (2025年6月20日)
- 顔認証システムの初回リリース
- 基本的な顔認証機能の実装

---

**注意事項**
- この技術仕様書は機密情報を含みます
- 関係者以外への開示は禁止されています
- システム更新時は必ずこの仕様書も更新してください
</pre>
</body>
</html> 