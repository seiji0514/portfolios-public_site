# トラブル対応マニュアル

## 目次
1. [LINE通知機能](#line通知機能)
2. [遠隔操作機能](#遠隔操作機能)
3. [緊急時の対応手順](#緊急時の対応手順)
4. [連絡網運用](#連絡網運用)
5. [トラブルシューティング](#トラブルシューティング)

---

## LINE通知機能

### 概要
システムの異常や重要なイベントをLINEグループに自動・手動で通知する機能です。

### 設定手順

#### 1. LINE Messaging APIの設定
1. [LINE Developers Console](https://developers.line.biz/)にアクセス
2. 新しいプロバイダーを作成
3. 新しいチャネル（Messaging API）を作成
4. チャネルアクセストークンを取得
5. Webhook URLを設定（必要に応じて）

#### 2. LINEグループの設定
1. LINEで管理者用グループを作成
2. グループIDを取得（LINE Botをグループに招待後、Webhookで取得）
3. 必要なメンバーをグループに招待

#### 3. 管理画面での設定
1. 統合管理画面の「LINE通知」タブを開く
2. LINE Access Tokenを入力
3. LINE Group IDを入力
4. 通知レベルを設定
5. 自動通知・手動通知の設定
6. 「設定保存」をクリック

### 通知レベル
- **all**: すべての通知
- **error**: エラーのみ
- **warning**: 警告以上
- **info**: 情報以上

### 自動通知の内容
- システムエラー
- AI機能エラー
- データ同期エラー
- デバイス接続エラー
- パフォーマンス警告

### 手動通知の送信
1. 管理画面の「手動通知送信」セクションを使用
2. メッセージを入力
3. 通知レベルを選択
4. 送信先を選択
5. 「通知送信」をクリック

---

## 遠隔操作機能

### 概要
ノートPCからデスクトップPCを遠隔操作する機能です。

### 設定手順

#### 1. デスクトップPC側の設定
1. デスクトップPCのIPアドレスを確認
2. ファイアウォールでポート8888を開放
3. 遠隔操作APIサーバーを起動

#### 2. ノートPC側の設定
1. 統合管理画面の「遠隔操作」タブを開く
2. デスクトップPCのIPアドレスを設定
3. 認証情報を設定
4. 許可する操作を設定

### 利用可能な操作
- **system_status**: システム状態確認
- **restart_service**: サービス再起動
- **backup_data**: データバックアップ
- **update_settings**: 設定更新
- **view_logs**: ログ表示
- **emergency_stop**: 緊急停止

### セッション管理
- セッションタイムアウト: 5分
- 自動タイムアウトチェック: 30秒間隔
- 手動セッション終了可能

### セキュリティ対策
- 認証必須
- 操作ログ記録
- 許可された操作のみ実行
- セッションタイムアウト

---

## 緊急時の対応手順

### 1. システム障害発生時

#### 即座に実行すべき手順
1. **緊急通知送信**
   - 管理画面で緊急レベルでLINE通知送信
   - 緊急連絡先に直接通知

2. **状況確認**
   - システム状態を確認
   - エラーログを確認
   - 影響範囲を特定

3. **初期対応**
   - サービス再起動を試行
   - データバックアップを実行
   - 必要に応じて緊急停止

#### 遠隔操作での対応
1. **遠隔操作セッション開始**
   - 認証情報を入力
   - デスクトップPCに接続

2. **システム状態確認**
   - CPU使用率、メモリ使用率を確認
   - ディスク容量を確認
   - ネットワーク接続を確認

3. **サービス再起動**
   - 問題のあるサービスを特定
   - サービスを再起動
   - 動作確認

### 2. データ損失の可能性がある場合

#### 即座の対応
1. **データバックアップ実行**
   - 遠隔操作でバックアップ実行
   - バックアップ完了を確認

2. **システム停止**
   - データ書き込みを停止
   - 安全な停止を実行

3. **専門家への連絡**
   - 技術担当者に連絡
   - データ復旧の可能性を確認

### 3. セキュリティインシデント

#### 対応手順
1. **ネットワーク切断**
   - 外部接続を切断
   - 内部ネットワークも必要に応じて切断

2. **ログ保存**
   - すべてのログを保存
   - 証拠保全を実行

3. **専門家への連絡**
   - セキュリティ専門家に連絡
   - 法的対応の準備

---

## 連絡網運用

### 連絡先の役割分担

#### システム管理者
- **役割**: システム全体の管理・運用
- **優先度**: 高
- **通知対象**: すべての重要通知

#### 技術担当者
- **役割**: 技術的な問題の解決
- **優先度**: 高
- **通知対象**: 技術的な問題、エラー

#### スタッフ
- **役割**: 日常的な運用・監視
- **優先度**: 中
- **通知対象**: 一般的な通知、報告

#### 緊急連絡先
- **役割**: 緊急時の対応
- **優先度**: 最高
- **通知対象**: 緊急事態のみ

### 連絡網の更新手順
1. 管理画面の「連絡網管理」で連絡先を編集
2. LINE IDの変更時はLINEグループも更新
3. 役割変更時は通知設定も見直し
4. 定期的に連絡先の有効性を確認

### 連絡網テスト
- **月次テスト**: 全連絡先へのテスト通知
- **緊急テスト**: 緊急連絡先へのテスト通知
- **機能テスト**: 各機能の動作確認

---

## トラブルシューティング

### LINE通知が送信されない

#### 確認項目
1. **Access Tokenの確認**
   - トークンが正しく設定されているか
   - トークンが有効期限切れでないか

2. **Group IDの確認**
   - グループIDが正しく設定されているか
   - Botがグループに招待されているか

3. **ネットワーク接続の確認**
   - インターネット接続が正常か
   - ファイアウォールでLINE APIがブロックされていないか

#### 対処方法
1. 管理画面で「接続テスト」を実行
2. ブラウザの開発者ツールでエラーを確認
3. 必要に応じてトークンを再発行

### 遠隔操作で接続できない

#### 確認項目
1. **ネットワーク接続の確認**
   - デスクトップPCにpingが通るか
   - ポート8888が開放されているか

2. **認証情報の確認**
   - ユーザー名・パスワードが正しいか
   - トークンが有効か

3. **デスクトップPC側の確認**
   - 遠隔操作APIサーバーが起動しているか
   - ファイアウォール設定は適切か

#### 対処方法
1. ネットワーク接続を確認
2. 認証情報を再設定
3. デスクトップPC側のサービスを再起動

### セッションが頻繁にタイムアウトする

#### 原因
- ネットワークが不安定
- デスクトップPCの負荷が高い
- セッションタイムアウト設定が短すぎる

#### 対処方法
1. ネットワーク環境を改善
2. デスクトップPCの負荷を軽減
3. セッションタイムアウト時間を延長

### 操作が実行されない

#### 確認項目
1. **権限の確認**
   - 操作が許可リストに含まれているか
   - 認証レベルが十分か

2. **セッション状態の確認**
   - セッションが有効か
   - タイムアウトしていないか

#### 対処方法
1. セッションを再開始
2. 操作権限を確認
3. 必要に応じて管理者に連絡

---

## 運用チェックリスト

### 日次チェック
- [ ] LINE通知の動作確認
- [ ] 遠隔操作の接続確認
- [ ] システムログの確認
- [ ] バックアップの確認

### 週次チェック
- [ ] 連絡網の有効性確認
- [ ] セキュリティログの確認
- [ ] パフォーマンスの確認
- [ ] 設定の見直し

### 月次チェック
- [ ] 全機能の動作テスト
- [ ] 連絡網のテスト通知
- [ ] セキュリティ設定の見直し
- [ ] 運用マニュアルの更新

---

## 緊急時連絡先

### システム管理者
- **名前**: [管理者名]
- **電話**: [電話番号]
- **LINE**: [LINE ID]
- **メール**: [メールアドレス]

### 技術担当者
- **名前**: [技術担当者名]
- **電話**: [電話番号]
- **LINE**: [LINE ID]
- **メール**: [メールアドレス]

### 緊急連絡先
- **名前**: [緊急連絡先名]
- **電話**: [電話番号]
- **LINE**: [LINE ID]
- **メール**: [メールアドレス]

### 外部サポート
- **ベンダー名**: [ベンダー名]
- **サポート電話**: [電話番号]
- **サポートメール**: [メールアドレス]
- **営業時間**: [営業時間]

---

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|----------|--------|
| 2024-01-15 | 初版作成 | システム管理者 |
| 2024-01-16 | LINE通知機能追加 | 技術担当者 |
| 2024-01-17 | 遠隔操作機能追加 | 技術担当者 |

---

**注意**: このマニュアルは定期的に更新し、最新の状態を保つようにしてください。 