# 運用開始前設定ガイド

## 目次
1. [LINE通知機能の設定](#line通知機能の設定)
2. [遠隔操作機能の設定](#遠隔操作機能の設定)
3. [連絡網の構築](#連絡網の構築)
4. [テスト運用](#テスト運用)
5. [本格運用開始](#本格運用開始)

---

## LINE通知機能の設定

### ステップ1: LINE Developers Consoleでの設定

#### 1.1 プロバイダーの作成
1. [LINE Developers Console](https://developers.line.biz/)にアクセス
2. 「新規プロバイダー作成」をクリック
3. プロバイダー名を入力（例：「リハビリシステム管理」）
4. 「作成」をクリック

#### 1.2 チャネルの作成
1. 作成したプロバイダーを選択
2. 「新規チャネル作成」をクリック
3. 「Messaging API」を選択
4. チャネル名を入力（例：「システム通知Bot」）
5. チャネル説明を入力
6. アイコンをアップロード（任意）
7. 「作成」をクリック

#### 1.3 アクセストークンの取得
1. 作成したチャネルを選択
2. 「Messaging API設定」タブを開く
3. 「チャネルアクセストークン（長期）」をコピー
4. 安全な場所に保存

#### 1.4 Webhook URLの設定（オプション）
1. 「Messaging API設定」タブで
2. 「Webhook URL」を設定（必要に応じて）
3. 「検証」ボタンで動作確認

### ステップ2: LINEグループの作成

#### 2.1 管理者用グループの作成
1. LINEアプリで新しいグループを作成
2. グループ名を設定（例：「リハビリシステム管理」）
3. 必要なメンバーを招待

#### 2.2 Botの招待
1. 作成したLINE Botをグループに招待
2. グループIDを取得（後述）

#### 2.3 グループIDの取得
1. Botをグループに招待後、WebhookでグループIDを取得
2. または、LINE Developers Consoleで確認
3. グループIDを安全な場所に保存

### ステップ3: 管理画面での設定

#### 3.1 基本設定
1. 統合管理画面の「LINE通知」タブを開く
2. 「LINE Access Token」に取得したトークンを入力
3. 「LINE Group ID」に取得したグループIDを入力

#### 3.2 通知レベル設定
- **推奨設定**: 「warning」（警告以上）
- **運用初期**: 「info」（情報以上）でテスト

#### 3.3 自動通知設定
- [x] 自動通知を有効にする
- [x] 手動通知を有効にする

#### 3.4 設定保存
1. 「設定保存」ボタンをクリック
2. 設定が保存されたことを確認

### ステップ4: 接続テスト
1. 「接続テスト」ボタンをクリック
2. LINEグループでテストメッセージを確認
3. 問題があれば設定を見直し

---

## 遠隔操作機能の設定

### ステップ1: デスクトップPC側の準備

#### 1.1 ネットワーク設定
1. デスクトップPCのIPアドレスを確認
   ```cmd
   ipconfig
   ```
2. 固定IPアドレスを設定（推奨）
3. ファイアウォールでポート8888を開放

#### 1.2 遠隔操作APIサーバーの準備
1. デスクトップPCにNode.jsをインストール
2. 遠隔操作APIサーバーのファイルを配置
3. 必要なパッケージをインストール

#### 1.3 認証設定
1. 管理者アカウントを作成
2. パスワードを設定
3. アクセストークンを生成

### ステップ2: ノートPC側の設定

#### 2.1 管理画面での設定
1. 統合管理画面の「遠隔操作」タブを開く
2. デスクトップPCのIPアドレスを入力
3. ポート番号を確認（デフォルト: 8888）

#### 2.2 認証情報の設定
1. ユーザー名を入力
2. パスワードを入力
3. アクセストークンを入力

#### 2.3 許可する操作の設定
- [x] system_status（システム状態確認）
- [x] restart_service（サービス再起動）
- [x] backup_data（データバックアップ）
- [x] view_logs（ログ表示）
- [ ] update_settings（設定更新）- 慎重に設定
- [ ] emergency_stop（緊急停止）- 緊急時のみ

### ステップ3: 接続テスト
1. 「接続開始」ボタンをクリック
2. 認証情報を入力
3. 接続成功を確認
4. 簡単な操作（システム状態確認）をテスト

---

## 連絡網の構築

### ステップ1: 連絡先の整理

#### 1.1 役割の定義
- **システム管理者**: システム全体の管理・運用
- **技術担当者**: 技術的な問題の解決
- **スタッフ**: 日常的な運用・監視
- **緊急連絡先**: 緊急時の対応

#### 1.2 連絡先情報の収集
各役割の担当者から以下を収集：
- 氏名
- 電話番号
- LINE ID
- メールアドレス
- 担当時間

### ステップ2: LINEグループの構築

#### 2.1 グループの階層化
- **全体グループ**: 全スタッフ向けの一般通知
- **管理者グループ**: 管理者・技術担当向けの重要通知
- **緊急グループ**: 緊急時のみの通知

#### 2.2 メンバーの招待
1. 各グループに適切なメンバーを招待
2. 役割に応じた権限を設定
3. グループルールを説明

### ステップ3: 管理画面での連絡網設定

#### 3.1 連絡先の登録
1. 管理画面の「連絡網管理」で連絡先を登録
2. 役割と優先度を設定
3. LINE IDを関連付け

#### 3.2 通知設定の最適化
- **管理者**: すべての重要通知
- **技術担当**: 技術的な問題、エラー
- **スタッフ**: 一般的な通知、報告
- **緊急連絡先**: 緊急事態のみ

---

## テスト運用

### ステップ1: 機能テスト

#### 1.1 LINE通知テスト
1. **自動通知テスト**
   - システムエラーを意図的に発生
   - 通知が正しく送信されることを確認

2. **手動通知テスト**
   - 各レベルでテスト通知を送信
   - 送信先が正しく設定されることを確認

3. **連絡網テスト**
   - 各連絡先に個別にテスト通知
   - 受信確認を実施

#### 1.2 遠隔操作テスト
1. **接続テスト**
   - セッション開始・終了のテスト
   - タイムアウト機能のテスト

2. **操作テスト**
   - 各操作の実行テスト
   - 結果の確認

3. **セキュリティテスト**
   - 認証失敗時の動作確認
   - 権限外操作の拒否確認

### ステップ2: 負荷テスト

#### 2.1 同時接続テスト
1. 複数のノートPCから同時接続
2. システムの安定性を確認

#### 2.2 大量通知テスト
1. 短時間に大量の通知を送信
2. LINE APIの制限を確認

### ステップ3: 障害シミュレーション

#### 3.1 ネットワーク障害
1. ネットワーク接続を一時的に切断
2. エラーハンドリングを確認

#### 3.2 システム障害
1. デスクトップPCを一時的に停止
2. 遠隔操作のエラー処理を確認

---

## 本格運用開始

### ステップ1: 最終確認

#### 1.1 設定の最終確認
- [ ] LINE通知設定が正しく動作
- [ ] 遠隔操作設定が正しく動作
- [ ] 連絡網が適切に構築
- [ ] 全機能のテストが完了

#### 1.2 ドキュメントの確認
- [ ] トラブル対応マニュアルが完成
- [ ] 運用チェックリストが準備
- [ ] 緊急時連絡先が整理

### ステップ2: 運用開始

#### 2.1 運用開始の通知
1. 全関係者に運用開始を通知
2. 各機能の使用方法を説明
3. 緊急時の連絡方法を確認

#### 2.2 監視体制の確立
1. 日次チェックの開始
2. 週次チェックの開始
3. 月次チェックの開始

### ステップ3: 継続的改善

#### 3.1 フィードバック収集
1. 運用中の問題点を収集
2. 改善要望を整理
3. 機能追加の検討

#### 3.2 定期的な見直し
1. 月次で設定の見直し
2. 四半期で機能の見直し
3. 年次で全体の見直し

---

## 設定チェックリスト

### LINE通知機能
- [ ] LINE Developers Consoleでプロバイダー作成
- [ ] Messaging APIチャネル作成
- [ ] アクセストークン取得
- [ ] LINEグループ作成
- [ ] グループID取得
- [ ] 管理画面で設定入力
- [ ] 接続テスト実行
- [ ] 通知テスト実行

### 遠隔操作機能
- [ ] デスクトップPCのIPアドレス確認
- [ ] ファイアウォール設定
- [ ] 遠隔操作APIサーバー準備
- [ ] 認証情報設定
- [ ] 管理画面で設定入力
- [ ] 接続テスト実行
- [ ] 操作テスト実行

### 連絡網構築
- [ ] 役割定義
- [ ] 連絡先情報収集
- [ ] LINEグループ構築
- [ ] 管理画面で連絡先登録
- [ ] 通知設定最適化
- [ ] 連絡網テスト実行

### テスト運用
- [ ] 機能テスト完了
- [ ] 負荷テスト完了
- [ ] 障害シミュレーション完了
- [ ] 問題点の修正完了

### 本格運用
- [ ] 最終確認完了
- [ ] 運用開始通知
- [ ] 監視体制確立
- [ ] 継続的改善体制確立

---

## 注意事項

### セキュリティ
- アクセストークンは安全に管理
- パスワードは定期的に変更
- 不要な権限は付与しない

### バックアップ
- 設定情報は定期的にバックアップ
- 重要なデータは複数箇所に保存
- 復旧手順を事前に確認

### 運用体制
- 担当者の不在時の代替体制を整備
- 緊急時の連絡方法を複数確保
- 定期的な訓練を実施

---

**運用開始前の設定は、システムの安定運用のために重要です。**
**十分な時間をかけて、段階的に設定を進めてください。** 